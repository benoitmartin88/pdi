logging: trace
metadata:
  mpi_rank: int
  # mpi_size = 4
data:
  int_submatrix:
    type: array
    subtype: int
    size: [4, 4]

plugins:
  mpi: ~
  decl_netcdf:
    - file: "test_06.nc"
      communicator: $MPI_COMM_WORLD
      on_event: "write"
      variables:
        int_matrix_var:
          type: array
          subtype: int
          size: [8, 8]
          dimensions: ["height", "width"]
      write:
        int_submatrix:
          variable: int_matrix_var
          variable_selection:
            start: ["($mpi_rank / 2) * 4", "($mpi_rank % 2) * 4"]
            subsize: [4, 4]
    - file: "test_06.nc"
      communicator: $MPI_COMM_WORLD  
      on_event: "read"
      variables:
        int_matrix_var:
          type: array
          subtype: int
          size: [8, 8]
      read:
        int_submatrix:
          variable: int_matrix_var
          variable_selection:
            start: ["($mpi_rank / 2) * 4", "($mpi_rank % 2) * 4"]
            subsize: [4, 4]
          
