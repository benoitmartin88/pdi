SET(FLOWVR_MPLAYER_VERSION "1.0rc1")
CONFIGURE_FILE(Makefile.flowvr ${CMAKE_CURRENT_BINARY_DIR}/Makefile.flowvr COPYONLY)
CONFIGURE_FILE(patch-${FLOWVR_MPLAYER_VERSION} ${CMAKE_CURRENT_BINARY_DIR}/patch-${FLOWVR_MPLAYER_VERSION} COPYONLY)


STRING(REPLACE ";" " " _include_dirs "${FLOWVR_INCLUDE_DIR}")
STRING(REPLACE ";" " " _libraries "${FLOWVR_base_LIBRARY} ${FLOWVR_mod_LIBRARY} ${FLOWVR_ftl_LIBRARY} ${FLOWVRRENDER_LIBRARY}")
STRING(REPLACE ";" " " _library_dir "${CMAKE_BINARY_DIR}/lib")

#MESSAGE(STATUS "FLOWVRRENDER_INCLUDE_DIR = ${FLOWVRRENDER_INCLUDE_DIR}")

SET(config.mak ${CMAKE_CURRENT_BINARY_DIR}/config.mak)
FILE(WRITE ${config.mak} "FLOWVR_INCLUDE_DIR := ${_include_dirs}\nFLOWVR_LIBRARY_DIRS := ${_library_dir}\nFLOWVR_LIBRARY := ${_libraries}\n")
FILE(APPEND ${config.mak} "FLOWVR_INC := $(addprefix -I,\$(FLOWVR_INCLUDE_DIR))\nFLOWVR_LIB := -L\$(FLOWVR_LIBRARY_DIRS) \$(FLOWVR_LIBRARY)")

ADD_CUSTOM_COMMAND(OUTPUT mplayer COMMAND ${CMAKE_MAKE_PROGRAM} -f Makefile.flowvr DEPENDS ${config.mak})
ADD_CUSTOM_COMMAND(OUTPUT ${CMAKE_BINARY_DIR}/bin/mplayer COMMAND ${CMAKE_COMMAND} -E copy_if_different mplayer ${CMAKE_BINARY_DIR}/bin/mplayer DEPENDS mplayer)

ADD_CUSTOM_TARGET(mplayer-flowvr ALL DEPENDS mplayer ${CMAKE_BINARY_DIR}/bin/mplayer)

# install needs some more work
INSTALL(PROGRAMS ${CMAKE_CURRENT_BINARY_DIR}/mplayer DESTINATION bin)
